# SaaS下多租户的数据隔离
SaaS多租户数据隔离的三种方案 
多租户技术或称多重租赁技术，是一种软件架构技术，是实现如何在多用户环境下共用相同的系统或程序组件，并且可确保各用户间数据的隔离性。在当下云计算时代，多租户技术在共用的数据中心以单一系统架构与服务提供多数客户端相同甚至可定制化的服务，并且仍可以保障客户的数据隔离。目前各种各样的云计算服务就是这类技术范畴，例如阿里云数据库服务（RDS）、阿里云服务器等等。

多租户在数据存储上存在三种主要的方案，分别是：

1. 独立数据库

这是第一种方案，即一个租户一个数据库，这种方案的用户数据隔离级别最高，安全性最好，但成本较高。 
优点： 
为不同的租户提供独立的数据库，有助于简化数据模型的扩展设计，满足不同租户的独特需求；如果出现故障，恢复数据比较简单。 
缺点： 
增多了数据库的安装数量，随之带来维护成本和购置成本的增加。 
这种方案与传统的一个客户、一套数据、一套部署类似，差别只在于软件统一部署在运营商那里。如果面对的是银行、医院等需要非常高数据隔离级别的租户，可以选择这种模式，提高租用的定价。如果定价较低，产品走低价路线，这种方案一般对运营商来说是无法承受的。

2. 共享数据库，隔离数据架构 
这是第二种方案，即多个或所有租户共享Database，但是每个租户一个Schema（也可叫做一个user）。 
优点： 
为安全性要求较高的租户提供了一定程度的逻辑数据隔离，并不是完全隔离；每个数据库可支持更多的租户数量。
缺点： 
如果出现故障，数据恢复比较困难，因为恢复数据库将牵涉到其他租户的数据； 
如果需要跨租户统计数据，存在一定困难。

3. 共享数据库，共享数据架构 
这是第三种方案，即租户共享同一个Database、同一个Schema，但在表中增加TenantID多租户的数据字段。这是共享程度最高、隔离级别最低的模式。 
优点： 
三种方案比较，第三种方案的维护和购置成本最低，允许每个数据库支持的租户数量最多。 
缺点： 
隔离级别最低，安全性最低，需要在设计开发时加大对安全的开发量； 
数据备份和恢复最困难，需要逐表逐条备份和还原。 
如果希望以最少的服务器为最多的租户提供服务，并且租户接受牺牲隔离级别换取降低成本，这种方案最适合。

这里我采用的是第三种隔离级别，因为成本低，维护比较方便；
所以我们的每张表都会有一个标识，即企业ID；在我们做所有操作的时候都会去过滤这个企业ID；

原始企业：

这里原始企业指什么啦，指我们卖saas产品的公司，这里的企业所有权限都有，而且里面必须有一个超级管理员，这个管理员也会拥有所有权限，来给其他公司授权；

第三方企业：

这里我们把入驻企业称为第三方企业，这个第三方企业有自己的权限，但是他的权限是原始企业授予他的，原始企业下面的角色最多也只能拥有该企业的权限。
